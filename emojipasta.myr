use std
use "misc"
use "radix/radix"

pkg fltr =
	const emojipasta : (line : byte[:] -> byte[:])
;;

var etree

/* this needs work... */
const emap = [
	/* hit or miss */
	("hit", "👊"),
	("miss", "😳"),
	("guess", "🤔"),
	("never", "❌"),
	("huh", "😕"),
	("boyfriend", "💑"),
	("kiss", "😘💋"),
	("find", "🔍"),
	("girl", "💃"),
	("dab", "😎"),

	/* i'm deleting you daddy*/
	("delet", "🙅"),
	("error", "🚫"),
	("true", "💯"),
	("dadd", "💖"),
	("daddy", "👅"),
	("daddy's", "👨‍👧"),
	("cum", "💦"),
	("cummie", "💦💦"),
	("squishy", "☁️💦"),
	("kitten", "😻"),

	/* navy seals */
	("fuck", "🍑🍆"),
	("fucking", "😈"),
	("bitch", "🎀"),
	("gorilla", "🦍"),
	("guerrilla", "🦍"),
	("war", "🔫"),
	("target", "🎯"),
	("navy", "⚓️"),
	("graduated", "👨‍🎓"),
	("earth", "🌎"),
	("spy", "🕵️‍♀️"),
	("spies", "🕵️‍♂️"),
	("usa", "🇺🇸🇺🇸"),
	("storm", "🌩"),
	("bare", "🐻"),
	("combat", "⚔️"),
	("dead", "⚰️"),

	("win", "🏆"),
	("pill", "💊"),
	("cash", "💵💵"),
	("money", "🤑"),
	("sale", "💸"),
	("price", "🏷"),
	("tag", "🏷"),
	("stop", "⛔️🚷"),
	("lewd", "🔞"),
	("alarm", "⏰"),
	("clock", "🕰"),
	("time", "⏳"),
	("alert", "🚨"),
	("warning", "☢️"),
	("warn", "⚠️"),
	("danger", "☣️"),
	("pray", "🙏"),
	("bridge", "🌉"),
	("bf", "👫"),
	("gf", "💑"),
	("girlfriend", "👫"),

	("lmao", "😂"),
	("fam", "😂"),
	("good", "😜"),
	("mad", "😡"),
	("made", ""),
	("angry", "🤬"),
	("think", "🤔"),
	("tired", "😪"),
	("gross", "🤮"),
	("sick", "😷"),
	("clown", "🤡"),
	("poo", "💩"),
	("shit", "💩"),
	("ok", "👌👌"),
	("cop", "👮‍♂️"),
	("doc", "👩‍⚕️"),
	("thots", "👯‍♀️"),
	("dress", "👗"),
	("ring", "💍"),
	("dog", "🐶"),
	("cat", "🐱"),
	("mouse", "🐭"),
	("hamster", "🐹"),
	("bunn", "🐰"),
	("fox", "🦊"),
	("bear", "🐻"),
	("moo", "🐮"),
	("pig", "🐷"),
	("frog", "🐸"),
	("meme", "🐸"),
	("monk", "🐵"),
	("chicken", "🐔"),
	("chick", "🐥"),
	("duck", "🦆"),
	("bat", "🦇"),
	("wolf", "🐺"),
	("bor", "🐗"),
	("boar", "🐗"),
	("pony", "🐴"),
	("bee", "🐝"),
	("been", ""),
	("snail", "🐌"),
	("ant", "🐜"),
	("bug", "🦟"),
	("web", "🕸"),
	("snake", "🐍"),
	("lizard", "🦎"),
	("dino", "🦖"),
	("octo", "🐙"),
	("squid", "🦑"),
	("crab", "🦀"),
	("puff", "🐡"),
	("fish", "🐠"),
	("dolph", "🐬"),
	("whale", "🐳"),
	("shark", "🦈"),
	("croc", "🐊"),
	("gator", "🐊"),
	("alligator", "🐊"),
	("tiger", "🐅"),
	("eleph", "🐘"),
	("hippo", "🦛"),
	("cow", "🐄"),
	("beef", "🐄"),
	("pork", "🐖"),
	("hog", "🐖"),
	("ram", "🐏"),
	("sheep", "🐑"),
	("lamb", "🐑"),
	("cock", "🐓"),
	("turkey", "🦃"),
	("bird", "🦜"),
	("swan", "🦢"),
	("rabbit", "🐇"),
	("bunny", "🐇"),
	("rat", "🐀"),
	("dragon", "🐉"),
	("tree", "🌲"),
	("herb", "🌿"),
	("leaf", "🍁"),
	("mushroom", "🍄"),
	("shroom", "🍄"),
	("shell", "🐚"),
	("flower", "🌷"),
	("rose", "🌹"),
	("wilt", "🥀"),
	("sun", "🌞"),
	("moon", "🌚"),
	("star", "⭐️"),
	("bolt", "⚡️"),
	("fire", "🔥🔥"),
	("cloud", "☁️"),
	("snowflake", "❄️"),
	("flake", "❄️"),
	("fruit", "🍏🍐"),
	("apple", "🍎"),
	("orange", "🍊"),
	("lemon", "🍋"),
	("grape", "🍇"),
	("melon", "🍈"),
	("cherr", "🍒"),
	("peach", "🍑"),
	("ass", "🍑"),
	("thicc", "🍑"),
	("coconut", "🥥"),
	("kiwi", "🥝"),
	("tomato", "🍅"),
	("eggplant", "🍆"),
	("dick", "🍆"),
	("avocado", "🥑"),
	("millenial", "🥑"),
	("chili", "🌶"),
	("pepper", "🌶"),
	("spicy", "🌶"),
	("corn", "🌽"),
	("world", "🌏"),
	("potato", "🥔"),
	("bagel", "🥯"),
	("bread", "🍞"),
	("cheese", "🧀"),
	("egg", "🥚"),
	("pancake", "🥞"),
	("bacon", "🥓"),
	("steak", "🥩"),
	("meat", "🍖"),
	("bone", "🦴"),
	("hamburger", "🍔"),
	("burger", "🍔"),
	("pizza", "🍕"),
	("taco", "🌮"),
	("burrito", "🌯"),
	("salad", "🥗"),
	("spaghetti", "🍝"),
	("ramen", "🍜"),
	("noodles", "🍜"),
	("curry", "🍛"),
	("sushi", "🍣"),
	("shrimp", "🍤"),
	("rice", "🍚"),
	("cake", "🍰"),
	("candy", "🍬"),
	("choco", "🍫"),
	("popcorn", "🍿"),
	("doughnut", "🍩"),
	("donut", "🍩"),
	("cookie", "🍪"),
	("peanut", "🥜"),
	("nuts", "🥜"),
	("honey", "🍯"),
	("milk", "🥛"),
	("bottle", "🍼"),
	("coffee", "☕️"),
	("tea", "🍵"),
	("beer", "🍻"),
	("pint", "🍺"),
	("wine", "🍷"),
	("drink", "🥃"),
	("party", "🍾"),
	("salt", "🧂"),
	("sport", "⚽️🏀"),

	("car", "🚗"),
	("taxi", "🚕"),
	("bus", "🚌"),
	("polic", "🚓"),
	("ambulance", "🚑"),
	("truck", "🚚"),
	("scoot", "🛴"),
	("bike", "🚲"),
	("scooter", "🛵"),
	("moto", "🏍"),
	("bullet", "🚅"),
	("train", "🚂"),
	("plane", "✈️"),
	("helicop", "🚁"),
	("boat", "🛥"),
	("ship", "🚢"),
	("anchor", "⚓️"),
	("liberty", "🗽"),
	("tower", "🗼"),
	("castle", "🏰"),
	("rollercoaster", "🎢"),
	("fount", "⛲️"),
	("umbrella", "⛱"),
	("beach", "🏖"),
	("island", "🏝"),
	("desert", "🏜"),
	("volcano", "🌋"),
	("eruption", "🌋"),
	("mount", "⛰"),
	("camp", "🏕"),
	("tent", "⛺️"),
	("house", "🏠"),
	("home", "🏡"),
	("neighborhood", "🏘"),
	("crane", "🏗"),
	("factory", "🏭"),
	("industry", "🏭"),
	("hospital", "🏥"),
	("hotel", "🏥"),
	("bank", "🏦"),
	("wave", "🌊"),
	("church", "⛪️"),
	("mosque", "🕌"),
	("temple", "🕍"),
	("god", "🕋"),
	("tracks", "🛤"),
	("road", "🛣"),

	("watch", "⌚️"),
	("phone", "📱"),
	("laptop", "💻"),
	("computer", "🖥"),
	("disk", "💿"),
	("tape", "📼"),
	("cam", "📷"),
	("film", "🎞"),
	("telev", "📺"),
	("mic", "🎙"),
	("battery", "🔋"),
	("plug", "🔌"),
	("lightbulb", "💡"),
	("bulb", "💡"),
	("idea", "💡"),
	("candle", "🕯"),
	("barrel", "🛢"),
	("oil", "🛢"),
	("diamond", "💎"),
	("gem", "💎"),
	("scale", "⚖️"),
	("justice", "⚖️"),
	("toolbox", "🧰"),
	("wrench", "🔧"),
	("hammer", "🔨"),
	("tools", "🛠"),
	("pick", "⛏"),
	("screw", "🔩"),
	("bolt", "🔩"),
	("nut", "🔩"),
	("gear", "⚙️"),
	("brick", "🧱"),
	("chain", "⛓"),
	("magnet", "🧲"),
	("watergun", "🔫"),
	("gun", "🔫"),
	("shoot", "🔫"),
	("bomb", "💣"),
	("dynamite", "🧨"),
	("knife", "🔪⚰️"),
	("kill", "🔪🔪"),
	("cigarette", "🚬"),
	("smoke", "🚬"),
	("coffin", "⚰️"),
	("die", "⚰️"),
]

const emojipasta = {line
	if etree == Zptr
		etree = radix.mk()
		for (k, v) : emap
			radix.put(etree, k, v)
		;;
	;;

	/* TODO: stop using strtok */
	var toks = std.strtok(line)
	var sb = std.mksb()
	for t : toks
		std.sbputs(sb, t)
		std.sbputc(sb, ' ')

		var t1 = lower(t)
		match radix.best(etree, t1)
		| `std.Some (_, v):
			if !std.sleq(v, "")
				var r = [1, 1, 1, 2, 2, 3][std.rand(0, 6)]
				for var i = 0; i < r; i++
					std.sbputs(sb, v)
				;;
				std.sbputc(sb, ' ')
			;;
		| `std.None:
		;;
		std.slfree(t1)
	;;
	-> std.strstrip(std.sbfin(sb))
}
